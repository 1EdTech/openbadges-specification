var api = `

<section id="api" data-model="org.1edtech.ob.v3p0.model" data-service-model="org.1edtech.ob.v3p0.rest.servicemodel"
  title="Open Badges API">
  <p>
    [=Open Badges=] can be exchanged using the API (application programming interface) defined here, or as
    <a href="#docformat">documents</a>.
  </p>
  <p>
    This specification defines a [=RESTful API=] protocol to be implemented by applications serving in the roles of
    [=Client=] and [=Resource Server=]. The API uses OAuth 2.0 for authentication and granular resource-based permission
    scopes. Please see the [[[OB-CERT-30]]] for a list of which endpoints must be implemented for certification.
  </p>

  <p>
    In addition to the documentation in this section, there are <a href="#docs-openapi">OpenAPI</a> files for the
    Open Badges API in both JSON and YAML format:
  </p>
  <ul>
    <li><a href="https://purl.imsglobal.org/spec/ob/v3p0/schema/openapi/imsob_v3p0.json">JSON OpenAPI File</a>
    </li>
    <li><a href="https://purl.imsglobal.org/spec/ob/v3p0/schema/openapi/imsob_v3p0.yaml">YAML OpenAPI File</a>
    </li>
  </ul>

  <section id="api-architecture">
    <h3>Architecture</h3>
    <figure id="ad-architecture">
      <img src="images/OB3_Architecture.svg" alt="Diagram showing the major components of the Open Badges API" />
      <figcaption>Diagram showing the major components of the Open Badges API</figcaption>
    </figure>
    <p>
      There are five key components to the API architecture.
    </p>
    <dl>
      <dt><dfn data-lt="Resource Owner">User</dfn></dt>
      <dd>
        This is the user that owns the resources ([=badges=]) that are on the [=resource server=]. Also called a
        Resource Owner.
      </dd>
      <dt><dfn>Web Browser</dfn></dt>
      <dd>This is the web browser the [=user=] interacts with.</dd>
      <dt>[=Client=]</dt>
      <dd>
        This is the web application that interacts with the [=resource server=] on behalf of the [=user=]. Also called
        Consumer in the [[[SEC-11]]].
      </dd>
      <dt><dfn>Authorization Server</dfn></dt>
      <dd>
        This is a [=server=] that implements the OAuth 2.0 endpoints on behalf of
        the [=resource server=]. In many systems, the [=authorization server=] and the [=resource server=] are
        combined.
      </dd>
      <dt><dfn data-lt="Provider">Resource Server</dfn></dt>
      <dd>
        This is the [=server=] that has the protected resources ([=badges=]). Also called Provider in the [[[SEC-11]]].
      </dd>
    </dl>
    <p>
      The role of each component during Registration, Obtaining Tokens, and Authenticating with Tokens are described
      below.
    </p>
  </section>

  <section id="api-endpoints" data-interface="org.1edtech.ob.v3p0.rest.openbadgecredentials.interface"
    title="Secure REST Endpoints">
    <p>
      All secure endpoint requests MUST be made over secure TLS 1.2 or 1.3 protocol.
    </p>
    <p>
      All of the Secure REST Endpoints endpoints are protected by OAuth 2.0 access tokens as described in
      [[[#api-security]]].
    </p>

    <h4 id="scopes">Scopes</h4>
    <p>
      Each endpoint requires an access token with a specific Open Badges scope as shown below.
    </p>
    <table class="simple">
      <thead>
        <tr>
          <th>Operation</th>
          <th>Scope</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><a href="#getcredentials">getCredentials</a></td>
          <td>
            <code>https://purl.imsglobal.org/spec/ob/v3p0/scope/assertion.readonly</code> -
            Permission to read assertions for the authenticated entity.
          </td>
        </tr>
        <tr>
          <td><a href="#postcredential">postCredential</a></td>
          <td>
            <code>https://purl.imsglobal.org/spec/ob/v3p0/scope/assertion.create</code> -
            Permission to create assertions for the authenticated entity.
          </td>
        </tr>
        <tr>
          <td><a href="#getprofile">getProfile</a></td>
          <td>
            <code>https://purl.imsglobal.org/spec/ob/v3p0/scope/profile.readonly</code> -
            Permission to read the profile for the authenticated entity.
          </td>
        </tr>
        <tr>
          <td><a href="#postprofile">postProfile</a></td>
          <td>
            <code>https://purl.imsglobal.org/spec/ob/v3p0/scope/profile.update</code> -
            Permission to update the profile for the authenticated entity.
          </td>
        </tr>
      </tbody>
    </table>

    <section data-operation="org.1edtech.ob.v3p0.rest.getcredentials.operation">
      <pre class="http example" title="Sample getCredentials Request">
        GET /ims/ob/v3p0/assertions?limit=2&offset=0 HTTP/1.1
        Host: example.edu
        Authorization: Bearer 863DF0B10F5D432EB2933C2A37CD3135A7BB7B07A68F65D92
        Accept: application/json
      </pre>
      <pre class="http example" title="Sample getCredentials Response (line breaks for clarity)">
        HTTP/1.1 200 OK
        Content-Type: application/ld+json
        X-Total-Count: 1
        Link: &lt;https://www.imsglobal.org/ims/ob/v3p0/assertions?limit=2&offset=1>; rel="next",
              &lt;https://www.imsglobal.org/ims/ob/v3p0/assertions?limit=2&offset=0>; rel="last",
              &lt;https://www.imsglobal.org/ims/ob/v3p0/assertions?limit=2&offset=0>; rel="first",
              &lt;https://www.imsglobal.org/ims/ob/v3p0/assertions?limit=2&offset=0>; rel="prev"

        {
          "compactJwsStrings": [
            "header.payload.signature",
            "header.payload.signature"
          ]
        }
      </pre>
    </section>
    <section data-operation="org.1edtech.ob.v3p0.rest.postcredential.operation">
      <pre class="http example" title="Sample postCredential Request">
        POST /ims/ob/v3p0/credentials HTTP/1.1
        Host: example.edu
        Authorization: Bearer 863DF0B10F5D432EB2933C2A37CD3135A7BB7B07A68F65D92
        Accept: text/plain
        Content-Type: text/plain

        header.payload.signature
      </pre>  
      <pre class="http example" title="Sample postCredential Response">
        HTTP/1.1 200 OK
        Content-Type: text/plain

        header.payload.signature
      </pre>
    </section>
    <section data-operation="org.1edtech.ob.v3p0.rest.getprofile.operation">
      <pre class="http example" title="Sample getProfile Request">
        GET /ims/ob/v3p0/profile HTTP/1.1
        Host: example.edu
        Authorization: Bearer 863DF0B10F5D432EB2933C2A37CD3135A7BB7B07A68F65D92
        Accept: application/json
      </pre>
      <pre class="http example" title="Sample getProfile Response">
        HTTP/1.1 200 OK
        Content-Type: application/json

        {
          "@context": [
            "https://purl.imsglobal.org/spec/ob/v3p0/context/ob_v3p0.jsonld"
          ],
          "type": "Profile",
          "id": "https://example.edu/issuers/565049",
          "name": "Example University"
        }
      </pre>
    </section>
    <section data-operation="org.1edtech.ob.v3p0.rest.postprofile.operation">
      <pre class="http example" title="Sample postProfile Request">
        POST /ims/ob/v3p0/profile HTTP/1.1
        Host: example.edu
        Authorization: Bearer 863DF0B10F5D432EB2933C2A37CD3135A7BB7B07A68F65D92
        Accept: application/json
        Content-Type: application/json

        {
          "@context": [
            "https://purl.imsglobal.org/spec/ob/v3p0/context/ob_v3p0.jsonld"
          ],
          "telephone": "111-222-3333"
        }
      </pre>
      <pre class="http example" title="Sample postProfile Response">
        {
          "@context": [
              "https://purl.imsglobal.org/spec/ob/v3p0/context/ob_v3p0.jsonld"
          ],
          "type": "Profile",
          "id": "https://example.edu/issuers/565049",
          "name": "Example University"
        }
      </pre>
    </section>
  </section>

  <section>
    <h2>Unsecured Endpoints</h2>

    <p>
      All unsecured endpoint requests MUST be made over secure TLS 1.2 or 1.3 protocol.
    </p>

    <!-- getManifest -->
    <section>
      <h3 id="getmanifest">getManifest</h3>
      <p>
        Fetch the service discovery document from the [=resource server=].
      </p>

      <h4 id="getprofile-request">Request Format</h4>

      <p><code>GET {baseUrl}/ims/ob/v3p0/discovery</code></p>
      <table class="simple">
        <thead>
          <tr>
            <th>URL Parameter</th>
            <th>Parameter Type</th>
            <th>Description</th>
            <th>Required</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>baseUrl</code></td>
            <td><a href="#org.1edtech.ob.v3p0.derived.url.class">URL</a></td>
            <td>The HTTP scheme (which MUST be "https"), domain name, and any other path
              elements required by the [=resource server=] (e.g. "https://example.edu/tenant").
            </td>
            <td>Required</td>
          </tr>
        </tbody>
      </table>

      <h4>Request Headers</h4>

      <table class="simple">
        <thead>
          <tr>
            <th>Request Header</th>
            <th>Description</th>
            <th>Required</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Accept: application/json</code></td>
            <td>
              If the content type <code>application/json</code> is not not included in the <code>Accept</code>
              header, the [=resource server=] MUST respond with 406 Not Acceptable.
            </td>
            <td>Required</td>
          </tr>
        </tbody>
      </table>

      <h4>Request Payload</h4>

      <p>There is no request payload.</p>

      <h4>Sample Request</h4>

      <pre class="http example" title="Sample request for a service description document">
        GET {tenant}/ims/ob/v3p0/discovery HTTP/1.1
        Host: example.edu
        Accept: application/json
      </pre>

      <h4 id="getprofile-responses">Responses</h4>

      <table class="simple">
        <thead>
          <tr>
            <th>HTTP Status Code</th>
            <th>Payload Type</th>
            <th>Description</th>
            <th>Payload Required</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>200</td>
            <td>Service Discovery Document</td>
            <td>&#39;OK&#39; - The service discovery document.</td>
            <td>Required</td>
          </tr>
          <tr>
            <td>400</td>
            <td><a href="#org.1edtech.ob.v3p0.imsx_statusinfo.class">Imsx_StatusInfo</a></td>
            <td>
              &#39;Bad Request&#39; - The request was invalid or cannot be served. The exact error should be explained
              in the response payload.
            </td>
            <td>Required</td>
          </tr>
        </tbody>
      </table>

      <h4>Response Headers</h4>

      <table class="simple">
        <thead>
          <tr>
            <th>Response Header</th>
            <th>Description</th>
            <th>Required</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>Content-Type: application/json</code></td>
            <td>The content type MUST be <code>application/json</code>.</td>
            <td>Required</td>
          </tr>
        </tbody>
      </table>

      <h4>Sample Response</h4>

      <pre class="http example" title="Sample response with a Service Discovery Document">
        HTTP/1.1 200 OK
        Content-Type: application/json; charset=utf-8
        
        ...
        "info": {
          "x-imssf-image": "https://example.edu/logo",
          "x-imssf-privacyPolicy": "https://example.edu/privacy",
          "title": "Example",
          "termsOfService": "https://example.edu/tos",
          ...
        },
        ...
        "components": {
          "securitySchemes": {
            "OAuth2ACG": {
              "type": "oauth2",
              "description": "OAuth 2.0 Authorization Code Grant authorization",
              "x-imssf-registrationUrl": "example.edu/registration",
              "flows": {
                "authorizationCode": {
                  "tokenUrl": "example.edu/token",
                  "authorizationUrl": "example.edu/authorize",
                  "refreshUrl": "example.edu/token",
                  "scopes": {
                    "https://purl.imsglobal.org/spec/ob/v3p0/scope/assertion.update" : "...",
                    "https://purl.imsglobal.org/spec/ob/v3p0/scope/assertion.readonly" : "...",
                    "https://purl.imsglobal.org/spec/ob/v3p0/scope/profile.readonly" : "...",
                    "https://purl.imsglobal.org/spec/ob/v3p0/scope/profile.update" : "..."
                  }
                }
              }
            }
          },
          "schemas": {
            ...
          }
        }
        ...
      </pre>
    </section>

  </section>

  <section>
    <h2>Retry Behavior</h2>
    <p>
      Receivers of requests MAY implement a <code>Retry-After</code> header to indicate a period of time to wait before
      attempting the request again.
    </p>
    <p>
      If no <code>Retry-After</code> header is present and the response is non-2XX, it is recommended to retry the
      request in 30 minutes for an additional two attempts. After which, it MAY be desirable to alert the recipient that
      there is an issue with the connection (e.g. perhaps they need to reauthenticate or manually trigger the request
      when they believe services are back up).
    </p>
  </section>
</section>

`;